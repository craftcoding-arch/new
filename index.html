<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر الأدوات المنزلية - الرئيسية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c5aa0;
            --secondary-color: #e8c547;
            --light-color: #f8f9fa;
            --dark-color: #333;
            --gray-color: #6c757d;
            --success-color: #28a745;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(to right, var(--primary-color), #1a3d7a);
            color: white;
            padding: 1rem 2rem;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .logo i {
            color: var(--secondary-color);
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            transition: background-color 0.3s;
        }
        
        nav a:hover, nav a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 4rem 2rem;
            border-radius: var(--border-radius);
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 1.5rem;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--secondary-color);
            color: var(--dark-color);
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background-color: #d4b236;
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1f4a8e;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary-color);
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            width: 80px;
            height: 3px;
            background-color: var(--secondary-color);
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .product-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
        }
        
        .product-img {
            height: 200px;
            width: 100%;
            object-fit: cover;
        }
        
        .product-info {
            padding: 1.2rem;
        }
        
        .product-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }
        
        .product-description {
            color: var(--gray-color);
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
        }
        
        .product-price {
            font-weight: bold;
            font-size: 1.3rem;
            color: var(--dark-color);
            margin-bottom: 1rem;
        }
        
        .product-category {
            display: inline-block;
            background-color: #e9ecef;
            color: var(--gray-color);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-bottom: 1rem;
        }
        
        .no-products {
            text-align: center;
            padding: 3rem;
            background-color: white;
            border-radius: var(--border-radius);
            grid-column: 1 / -1;
        }
        
        .no-products i {
            font-size: 3rem;
            color: var(--gray-color);
            margin-bottom: 1rem;
        }
        
        /* إدارة المنتجات */
        .admin-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .form-container {
            background-color: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .form-group {
            margin-bottom: 1.2rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .alert {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: none;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .products-list {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background-color: var(--primary-color);
            color: white;
        }
        
        th, td {
            padding: 1rem;
            text-align: right;
            border-bottom: 1px solid #eee;
        }
        
        tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            padding: 0.3rem;
            border-radius: 4px;
        }
        
        .btn-edit {
            color: var(--primary-color);
        }
        
        .btn-delete {
            color: #dc3545;
        }
        
        footer {
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            padding: 2rem 1rem;
            margin-top: 3rem;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* تصميم متجاوب */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
        }
        
        @media (max-width: 480px) {
            .hero {
                padding: 2rem 1rem;
            }
            
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- الهيدر -->
    <header>
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-home"></i>
                <span>مَتْجَرُ الْأَدَوَاتِ الْمَنْزِلِيَّةِ</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-page="home">الرئيسية</a></li>
                    <li><a href="#" class="nav-link" data-page="products">المنتجات</a></li>
                    <li><a href="#" class="nav-link" data-page="admin">إدارة المنتجات</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- المحتوى الرئيسي -->
    <main>
        <!-- الصفحة الرئيسية -->
        <section id="home-page" class="page active">
            <div class="hero">
                <h1>أفضل الأدوات المنزلية بجودة عالية</h1>
                <p>اكتشف تشكيلتنا الواسعة من الأدوات المنزلية المتميزة التي تجمع بين الجودة العالية والتصميم العصري لتناسب جميع أذواقكم ومتطلبات منازلكم.</p>
                <a href="#" class="btn btn-primary nav-link" data-page="products">استعرض المنتجات</a>
            </div>
            
            <h2 class="section-title">منتجاتنا المميزة</h2>
            
            <div class="products-grid" id="featured-products">
                <!-- سيتم تعبئة المنتجات المميزة هنا بواسطة الجافاسكريبت -->
            </div>
        </section>

        <!-- صفحة المنتجات -->
        <section id="products-page" class="page">
            <h2 class="section-title">جميع المنتجات</h2>
            
            <div class="products-grid" id="all-products">
                <!-- سيتم تعبئة جميع المنتجات هنا بواسطة الجافاسكريبت -->
            </div>
        </section>

        <!-- صفحة إدارة المنتجات -->
        <section id="admin-page" class="page">
            <h2 class="section-title">إدارة المنتجات</h2>
            
            <div class="admin-container">
                <div class="form-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary-color);">
                        <i class="fas fa-plus-circle"></i> إضافة منتج جديد
                    </h3>
                    
                    <div id="alert-message" class="alert"></div>
                    
                    <form id="product-form">
                        <div class="form-group">
                            <label for="product-name">اسم المنتج *</label>
                            <input type="text" id="product-name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="product-description">وصف المنتج *</label>
                            <textarea id="product-description" required></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="product-price">السعر (ر.س) *</label>
                                <input type="number" id="product-price" min="0" step="0.01" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="product-category">الفئة *</label>
                                <select id="product-category" required>
                                    <option value="">اختر فئة</option>
                                    <option value="أدوات المطبخ">أدوات المطبخ</option>
                                    <option value="أدوات التنظيف">أدوات التنظيف</option>
                                    <option value="الأثاث المنزلي">الأثاث المنزلي</option>
                                    <option value="الإضاءة">الإضاءة</option>
                                    <option value="أدوات الحمام">أدوات الحمام</option>
                                    <option value="أدوات التخزين">أدوات التخزين</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="product-image-file">صورة المنتج من الجهاز *</label>
                            <input type="file" id="product-image-file" accept="image/*">
                            <input type="hidden" id="product-image-url">
                            <small style="display: block; margin-top: 0.5rem; color: #6c757d;">
                                عند تعديل منتج، اترك هذا الحقل فارغًا إذا كنت لا تريد تغيير الصورة.
                            </small>
                        </div>
                        
                        <input type="hidden" id="product-id">
                        
                        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                            <button type="submit" class="btn btn-primary" id="submit-btn">
                                <i class="fas fa-save"></i> حفظ المنتج
                            </button>
                            <button type="button" class="btn" id="reset-btn" style="background-color: #6c757d; color: white;">
                                <i class="fas fa-redo"></i> مسح النموذج
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="products-list">
                    <h3 style="padding: 1.5rem 1.5rem 0; color: var(--primary-color);">
                        <i class="fas fa-list"></i> قائمة المنتجات
                    </h3>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>الصورة</th>
                                <th>اسم المنتج</th>
                                <th>الفئة</th>
                                <th>السعر</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body">
                            <!-- سيتم تعبئة جدول المنتجات هنا بواسطة الجافاسكريبت -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- الفوتر -->
    <footer>
        <div class="footer-content">
            <p>© 2023 متجر الأدوات المنزلية. جميع الحقوق محفوظة.</p>
            <p style="margin-top: 0.5rem; color: #ccc;">
                <i class="fas fa-phone"></i> ٠٥٠١٢٣٤٥٦٧ | 
                <i class="fas fa-envelope"></i> info@home-tools.com
            </p>
        </div>
    </footer>

    <script src="https://api.backendless.com/sdk/js/latest/backendless.min.js"></script>
    <script>
        // إعداد Backendless: ضع subdomain الخاص بتطبيقك بدل القيمة الافتراضية
        const BACKENDLESS_APP_URL = "https://subtlegrass-us.backendless.app";
        const PRODUCTS_TABLE = "Products";
        const PRODUCT_IMAGES_PATH = "product-images";

        let products = [];
        let productsStore = null;

        function initializeBackendless() {
            if (BACKENDLESS_APP_URL.includes("YOUR_SUBDOMAIN")) {
                throw new Error("يرجى تعيين رابط Backendless الصحيح في المتغير BACKENDLESS_APP_URL.");
            }

            Backendless.initApp(BACKENDLESS_APP_URL);
            productsStore = Backendless.Data.of(PRODUCTS_TABLE);
        }

        async function loadProducts() {
            products = await productsStore.find();
        }

        async function uploadProductImage(file) {
            if (!file) return "";
            if (!file.type.startsWith("image/")) {
                throw new Error("الملف المحدد ليس صورة.");
            }

            const folder = `${PRODUCT_IMAGES_PATH}/${Date.now()}`;
            const uploadResult = await Backendless.Files.upload(file, folder, true);
            return typeof uploadResult === "string"
                ? uploadResult
                : uploadResult.fileURL || uploadResult.url || "";
        }

        function renderAllSections() {
            displayFeaturedProducts();
            displayAllProducts();
            displayProductsTable();
        }

        // عرض المنتجات في الصفحة الرئيسية
        function displayFeaturedProducts() {
            const container = document.getElementById("featured-products");
            if (!container) return;

            container.innerHTML = "";

            // عرض أول 4 منتجات فقط في الصفحة الرئيسية
            const featuredProducts = products.slice(0, 4);

            if (featuredProducts.length === 0) {
                container.innerHTML = `
                    <div class="no-products">
                        <i class="fas fa-box-open"></i>
                        <h3>لا توجد منتجات بعد</h3>
                        <p>قم بإضافة منتجات جديدة من خلال صفحة إدارة المنتجات</p>
                    </div>
                `;
                return;
            }

            featuredProducts.forEach((product) => {
                const productCard = createProductCard(product);
                container.appendChild(productCard);
            });
        }

        // عرض جميع المنتجات
        function displayAllProducts() {
            const container = document.getElementById("all-products");
            if (!container) return;

            container.innerHTML = "";

            if (products.length === 0) {
                container.innerHTML = `
                    <div class="no-products">
                        <i class="fas fa-box-open"></i>
                        <h3>لا توجد منتجات بعد</h3>
                        <p>قم بإضافة منتجات جديدة من خلال صفحة إدارة المنتجات</p>
                    </div>
                `;
                return;
            }

            products.forEach((product) => {
                const productCard = createProductCard(product);
                container.appendChild(productCard);
            });
        }

        // إنشاء بطاقة منتج
        function createProductCard(product) {
            const card = document.createElement("div");
            card.className = "product-card";
            card.innerHTML = `
                <img src="${product.image}" alt="${product.name}" class="product-img">
                <div class="product-info">
                    <span class="product-category">${product.category}</span>
                    <h3 class="product-title">${product.name}</h3>
                    <p class="product-description">${product.description}</p>
                    <div class="product-price">${Number(product.price).toFixed(2)} ر.س</div>
                </div>
            `;
            return card;
        }

        // عرض جدول المنتجات في صفحة الإدارة
        function displayProductsTable() {
            const tableBody = document.getElementById("products-table-body");
            if (!tableBody) return;

            tableBody.innerHTML = "";

            if (products.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 2rem;">
                            <i class="fas fa-box-open" style="font-size: 2rem; color: #6c757d; margin-bottom: 1rem;"></i>
                            <p>لا توجد منتجات بعد. قم بإضافة منتج جديد.</p>
                        </td>
                    </tr>
                `;
                return;
            }

            products.forEach((product) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td><img src="${product.image}" alt="${product.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;"></td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${Number(product.price).toFixed(2)} ر.س</td>
                    <td>
                        <div class="actions">
                            <button class="btn-icon btn-edit" onclick="editProduct('${product.objectId}')" title="تعديل">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteProduct('${product.objectId}')" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // إضافة/تعديل منتج
        async function handleProductFormSubmit(e) {
            e.preventDefault();

            const submitBtn = document.getElementById("submit-btn");
            const productId = document.getElementById("product-id").value;
            const name = document.getElementById("product-name").value.trim();
            const description = document.getElementById("product-description").value.trim();
            const price = parseFloat(document.getElementById("product-price").value);
            const category = document.getElementById("product-category").value;
            const imageFileInput = document.getElementById("product-image-file");
            const selectedFile = imageFileInput.files[0];
            const currentImageUrl = document.getElementById("product-image-url").value;

            if (!name || !description || Number.isNaN(price) || !category) {
                showAlert("يرجى ملء جميع الحقول المطلوبة", "error");
                return;
            }

            if (price < 0) {
                showAlert("السعر يجب أن يكون رقمًا موجبًا", "error");
                return;
            }

            if (!selectedFile && !currentImageUrl) {
                showAlert("يرجى اختيار صورة من الجهاز", "error");
                return;
            }

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جار الحفظ...';

            try {
                let imageUrl = currentImageUrl;
                if (selectedFile) {
                    imageUrl = await uploadProductImage(selectedFile);
                }

                const productPayload = {
                    name,
                    description,
                    price,
                    category,
                    image: imageUrl
                };

                if (productId) {
                    await productsStore.save({
                        objectId: productId,
                        ...productPayload
                    });
                    showAlert("تم تحديث المنتج بنجاح", "success");
                } else {
                    await productsStore.save(productPayload);
                    showAlert("تم إضافة المنتج بنجاح", "success");
                }

                await loadProducts();
                renderAllSections();
                resetForm();
            } catch (error) {
                showAlert(`فشل حفظ المنتج: ${error.message}`, "error");
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = productId
                    ? '<i class="fas fa-save"></i> تحديث المنتج'
                    : '<i class="fas fa-save"></i> حفظ المنتج';
            }
        }

        // تعديل منتج
        function editProduct(objectId) {
            const product = products.find((p) => p.objectId === objectId);
            if (!product) return;

            document.getElementById("product-id").value = product.objectId;
            document.getElementById("product-name").value = product.name;
            document.getElementById("product-description").value = product.description;
            document.getElementById("product-price").value = product.price;
            document.getElementById("product-category").value = product.category;
            document.getElementById("product-image-url").value = product.image;
            document.getElementById("product-image-file").value = "";

            document.getElementById("submit-btn").innerHTML = '<i class="fas fa-save"></i> تحديث المنتج';

            // التمرير إلى أعلى النموذج
            document.querySelector(".form-container").scrollIntoView({ behavior: "smooth" });

            showAlert("يمكنك الآن تعديل المنتج", "success");
        }

        // حذف منتج
        async function deleteProduct(objectId) {
            if (!confirm("هل أنت متأكد من حذف هذا المنتج؟")) return;

            try {
                await productsStore.removeById(objectId);
                await loadProducts();
                renderAllSections();
                showAlert("تم حذف المنتج بنجاح", "success");
            } catch (error) {
                showAlert(`فشل حذف المنتج: ${error.message}`, "error");
            }
        }

        // إعادة تعيين النموذج
        function resetForm() {
            document.getElementById("product-form").reset();
            document.getElementById("product-id").value = "";
            document.getElementById("product-image-url").value = "";
            document.getElementById("submit-btn").innerHTML = '<i class="fas fa-save"></i> حفظ المنتج';
        }

        // عرض رسالة تنبيه
        function showAlert(message, type) {
            const alert = document.getElementById("alert-message");
            alert.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = "block";

            setTimeout(() => {
                alert.style.display = "none";
            }, 3000);
        }

        // تبديل الصفحات
        function setupNavigation() {
            const navLinks = document.querySelectorAll(".nav-link");
            const pages = document.querySelectorAll(".page");

            navLinks.forEach((link) => {
                link.addEventListener("click", function(e) {
                    e.preventDefault();

                    const targetPage = this.getAttribute("data-page");

                    // تحديث حالة الروابط
                    navLinks.forEach((navLink) => navLink.classList.remove("active"));
                    this.classList.add("active");

                    // إظهار الصفحة المحددة
                    pages.forEach((page) => {
                        page.classList.remove("active");
                        if (page.id === `${targetPage}-page`) {
                            page.classList.add("active");
                        }
                    });

                    // تحديث محتوى الصفحة عند التبديل
                    if (targetPage === "products") {
                        displayAllProducts();
                    } else if (targetPage === "home") {
                        displayFeaturedProducts();
                    } else if (targetPage === "admin") {
                        displayProductsTable();
                    }
                });
            });
        }

        // تهيئة التطبيق عند تحميل الصفحة
        document.addEventListener("DOMContentLoaded", async function() {
            // تعيين معالج النموذج
            const productForm = document.getElementById("product-form");
            if (productForm) {
                productForm.addEventListener("submit", handleProductFormSubmit);
            }

            // تعيين زر إعادة التعيين
            const resetBtn = document.getElementById("reset-btn");
            if (resetBtn) {
                resetBtn.addEventListener("click", resetForm);
            }

            // تهيئة التنقل بين الصفحات
            setupNavigation();

            try {
                initializeBackendless();
                await loadProducts();
                renderAllSections();
            } catch (error) {
                showAlert(`تعذر الاتصال بـ Backendless: ${error.message}`, "error");
            }
        });
    </script>
</body>
</html>
